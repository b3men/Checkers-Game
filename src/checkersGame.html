<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Checkers Game</title>
    <style>
        body { /*define o estilo do tabuleiro, local, cor de fundo etc*/
            font-family: "Arial Black", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: lightblue;
            margin: 0;
        }

        h1 { /* Define a cor e tamanho do título*/
            margin-bottom: 20px;
            color: whitesmoke;
        }

        .board { /* tabuleiro em si, tamanho de quadrados, margem*/
            display: flex;
            flex-wrap: wrap;
            width: 400px; /* 8 quadrados */
            height: 400px;
            border: 2px solid #333;
        }

        .square { /* infos do quadrado */
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
        }

        .black {
            background-color: black; /* Cor dos quadrados */
        }

        .white {
            background-color: white; /* Cor dos quadrados */
        }

        .piece { /* estilo da peça */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer; /*altera o cursor para 'cursor de clique'*/
            position: absolute;
        }

        .piece.player1 {
            background-color: red; /*cor das peças*/
        }

        .piece.player2 {
            background-color: blue; /*cor das peças*/
        }

        .piece.king {
            position: relative; /* importante para o ::after funcionar corretamente */
        }

        .piece.king::after { /*transforma uma peça comum em dama*/
            content: "♔"; /* layout da peça quando vira dama */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* posiciona o ícone da dama no centro da peça*/
            font-size: 20px;
            color: gold;
            text-shadow: 1px 1px 2px #333;
            pointer-events: none;
        }

        .piece.selected {
            border: 3px solid yellow;
        }

        .possible-move {
            box-shadow: inset 0 0 10px yellow;
        }

        .status { /* frase de turno do jogador */
            margin-top: 1px;
            font-size: 20px;
            color: whitesmoke;
        }

        .reset-button { /* layout do botão de reiniciar */
            margin-top: 30px;
            padding: 20px 30px;
            background-color: green;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .reset-button:hover { /* cor do botão quando há cursor encima*/
            background-color: darkgreen;
        }
    </style>
</head>

<body>

<h1>JInteractive Checkers Game</h1>
<div id="status" class="status">Turn: Player 1 (Red)</div>
<div class="board" id="board"><!-- local em que o tabuleiro é montado --></div>
<button class="reset-button" onclick="resetBoard()">Restart Game</button>

<script>
    const tamanho_tabuleiro = 8;
    let board = [];
    let currentPlayer = 1; // Inicia com o jogador 1 (vermelho)
    let selectedSquare = null;
    let possibleMoves = [];

    function initBoard() { //limpa o tabuleiro e zera a matriz para que possa ser iniciado um novo jogo
        const boardElement = document.getElementById('board');
        boardElement.innerHTML = '';
        board = [];

        for (let row = 0; row < tamanho_tabuleiro; row++) {
            const boardRow = []; //loop que percorre o tabuleiro e cria os quadrados utilizando .square
            for (let col = 0; col < tamanho_tabuleiro; col++) {
                const square = document.createElement('div');
                square.classList.add('square');
                if ((row + col) % 2 === 0) { // quadrados brancos
                    square.classList.add('white');
                } else { //quadrados pretos
                    square.classList.add('black');

                    // dá cor às peças dos players
                    let peca_tabuleiro = null;
                    if (row < 3 && (row + col) % 2 !== 0) {
                        peca_tabuleiro = {player: 2, king: false}; // recebe azul
                    } else if (row > 4 && (row + col) % 2 !== 0) {
                        peca_tabuleiro = {player: 1, king: false}; // recebe vermelho
                    }
                    if (peca_tabuleiro) { // verifica se há peças e cria o div (layout)
                        const pecaObjeto = document.createElement('div');
                        pecaObjeto.classList.add('piece', `player${peca_tabuleiro.player}`);
                        if (peca_tabuleiro.king) { //coloca o ícone de dama
                            pecaObjeto.classList.add('king');
                        }
                        square.appendChild(pecaObjeto);
                    }
                }
                square.dataset.row = row; //linha
                square.dataset.col = col;//coluna
                square.addEventListener('click', onSquareClick);
                boardElement.appendChild(square);
                boardRow.push({piece: null, element: square});
            }
            board.push(boardRow);
        }
        updateBoard(); // salva no tabuleiro as jogadas
    }
    function updateBoard() { // metodo vazio
    }

    // busca o local do click, quadrado, linha e coluna
    function onSquareClick(event) {
        const square = event.currentTarget;
        const row = parseInt(square.dataset.row);
        const col = parseInt(square.dataset.col);
        const objetoPeca = square.querySelector('.piece');

        if (selectedSquare) {
            if (possibleMoves.some(move => move.row === row && move.col === col)) {//verifica se há movimentos possíveis
                // Clona a peça antes de remover e já remove
                const copiaPecaOriginal = selectedSquare.querySelector('.piece');
                if (!copiaPecaOriginal) return;
                const newObjetoPeca = copiaPecaOriginal.cloneNode(true);
                copiaPecaOriginal.remove();

                // Verificar se é captura
                const selectedRow = parseInt(selectedSquare.dataset.row);
                const selectedCol = parseInt(selectedSquare.dataset.col);
                const deltaRow = row - selectedRow;
                const deltaCol = col - selectedCol;

                if (Math.abs(deltaRow) === 2) { //calcula se é captura baseado na quantidade de quadrados pulados
                    const jumpedRow = selectedRow + deltaRow / 2;
                    const jumpedCol = selectedCol + deltaCol / 2;
                    const jumpedSquare = document.querySelector(`[data-row="${jumpedRow}"][data-col="${jumpedCol}"]`);
                    jumpedSquare.querySelector('.piece')?.remove();
                }

                // Move a peça clonada para novo quadrado
                square.appendChild(newObjetoPeca);

                // Remove a seleção e os efeitos
                selectedSquare.classList.remove('selected');
                possibleMoves.forEach(move => {
                    const s = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                    s.classList.remove('possible-move');
                });
                possibleMoves = [];
                selectedSquare = null;

                // transforma a peça comum em dama, add o ícone
                if (!newObjetoPeca.classList.contains('king')) {
                    if ((currentPlayer === 1 && row === 0) || (currentPlayer === 2 && row === 7)) {
                        newObjetoPeca.classList.add('king');
                    }
                }

                // Alternar jogador
                currentPlayer = currentPlayer === 1 ? 2 : 1;
                document.getElementById('status').textContent = `Turn: Player ${currentPlayer} (${currentPlayer === 1 ? 'Red' : 'Blue'})`;
            } else {
                // Clique inválido — desfazer seleção
                selectedSquare.classList.remove('selected');
                possibleMoves.forEach(move => {
                    const s = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                    s.classList.remove('possible-move');
                });
                possibleMoves = [];
                selectedSquare = null;
            }

        } else if (objetoPeca) {
            // seleciona a peça se for do jogador correspondente
            const player = objetoPeca.classList.contains('player1') ? 1 : 2;
            if (player === currentPlayer) {
                selectedSquare = square;
                square.classList.add('selected');
                possibleMoves = getPossibleMoves(row, col, objetoPeca.classList.contains('king'));
                possibleMoves.forEach(move => {
                    const s = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                    s.classList.add('possible-move');
                });
            }
        }
    }

    // Adiciona os movimentos possíveis da peça
    function getPossibleMoves(row, col, isKing) {
        const moves = [];
        const player = currentPlayer;
        const directions = isKing ? [-1, 1] : (player === 1 ? [-1] : [1]);

        directions.forEach(dir => {
            [-1, 1].forEach(deltaCol => {
                // movimentos simples
                const newRow = row + dir;
                const newCol = col + deltaCol;
                if (isValidSquare(newRow, newCol) && !hasPiece(newRow, newCol)) {
                    moves.push({row: newRow, col: newCol});
                }
                // movimento de captura
                const jumpRow = row + 2 * dir;
                const jumpCol = col + 2 * deltaCol;
                if (isValidSquare(jumpRow, jumpCol) && !hasPiece(jumpRow, jumpCol) &&
                    hasOpponentPiece(row + dir, newCol, player)) {
                    moves.push({row: jumpRow, col: jumpCol, jump: true});
                }
            });
        });

        return moves;
    }

    // verifica se o quadrado seleciondo é valido de acordo com o tamanho do tabuleiro
    function isValidSquare(row, col) {
        return row >= 0 && row < tamanho_tabuleiro && col >= 0 && col < tamanho_tabuleiro;
    }

    // verifica se o quadrado selecionado já tem uma peça do próprio jogador
    function hasPiece(row, col) {
        const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
        return !!square.querySelector('.piece');
    }

    // verifica se o quadrado seleciondo tem uma peça do oponente
    function hasOpponentPiece(row, col, player) {
        const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
        const piece = square.querySelector('.piece');
        if (piece) {
            const piecePlayer = piece.classList.contains('player1') ? 1 : 2;
            return piecePlayer !== player;
        }
        return false;
    }

    // reinicia o tabuleiro
    function resetBoard() {
        initBoard();
        currentPlayer = 1;
        selectedSquare = null;
        possibleMoves = [];
        document.getElementById('status').textContent = 'Turn: Player 1 (Red)';
    }

    // inicializa a página
    document.addEventListener('DOMContentLoaded', initBoard);
</script>
</body>
</html>